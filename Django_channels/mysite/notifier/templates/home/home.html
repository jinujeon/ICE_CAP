{% load staticfiles %}
<html>
  <head>
    <title>Notifier</title>
    <script src="{% static '/channels/js/websocketbridge.js' %}" type="text/javascript"></script>
  </head>
  <body>
    <h1>Notifier</h1>
    <p>Notifications</p>
    <ul id="notifylist"></ul>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      const webSocketBridge = new channels.WebSocketBridge();
      const nl = document.querySelector("#notifylist");
      var alert_audio = new Audio('audios/note.mp3');
      alert_audio.volume = (1.0);
      function popupOpen(){
		var url= "home/alert.html";    
		var winWidth = 700;
	    var winHeight = 600;
	    var popupOption= "width="+winWidth+", height="+winHeight;    
		window.open(url,"",popupOption);
	}

      webSocketBridge.connect('/notifications/');
      webSocketBridge.listen(function(action, stream) {
        console.log("RESPONSE:", action);
        if(action.event == "warning") {
          var el = document.createElement("li");
          el.innerHTML = `Warning on camera<b>${action.cam_id}</b>!(location:${action.cam_location})`;
          nl.appendChild(el);
	  alert_audio.play();
	  popupOpen();
        }
	else if(action.event == "created") {
          var el = document.createElement("li");
          el.innerHTML = `New camera <b>${action.cam_id}</b> has installed!(location:${action.cam_location})`;
          nl.appendChild(el);
        }
      })
      document.ws = webSocketBridge; /* for debugging */
    })
    </script>
  </body>
</html>
